---
title: "CorrectionClassification"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CorrectionClassification & LengthsFile}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)


library(correspondenceTables)
```

**Introduction**

This vignette explains how to use the functions
correctionClassification() and lengthsFile()
from the correspondenceTables package.

These functions help clean and standardise classification tables
retrieved from the CELLAR or FAO repositories, or loaded locally from CSV
files (as used in package vignettes and tests).

**CorrectionClassification**

The function correctionClassification() applies a set of
prefix-specific cleaning rules to a classification table.
It ensures that:

code names follow a standardised structure,
section letters (A, B, C, …) are added when required,
problematic or invalid codes are removed,
and formatting inconsistencies are corrected.
The function requires a two-column input:
Classification Code (e.g. "0101", "10.0", "84")
Classification Label (the English label of the concept)

**Applying the function**

The following example demonstrates how to load a local NACE2 table
distributed with the package and apply the correction rules.
```{r}
# Load the raw NACE Rev.2 classification (CSV included in the package)

nace2_path <- system.file(
"extdata", "Nace2.csv",
package = "correspondenceTables"
)

nace2_raw <- read.csv(
nace2_path,
stringsAsFactors = FALSE
)

# Apply correction rules (no SPARQL request)

nace2_corrected <- correctionClassification(
classification = nace2_raw,
prefix = "nace2"
)

# Display result

head(nace2_corrected)

```
**Overview of the correction rules**

When correctionClassification() is applied:
1. The first column is automatically renamed to the prefix
2. Section letters (A, B, C, …) are automatically added
For classifications such as:
NACE Rev.2
NACE Rev.2.1
CPA21
ISIC Rev.4
The function identifies numeric ranges (e.g. "01" → Section A,
"05" → Section B, "10"–"33" → Section C, etc.)
and prepends the correct section letter.
3. Additional prefix-specific cleaning rules apply
Depending on the classification prefix:
ecoicop
Removes .0 from top-level divisions "10.0", "11.0", "12.0".
prodcom2019
Removes invalid codes "00.99.t" and "00.99.z".
CN classifications (cn2017–cn2023)
Removes section rows containing letters (A, B, C, …).
CBF classifications
Removes trailing "." in codes.
4. No SPARQL request is triggered
When using local CSV files (as in vignettes), the correction step is
performed entirely offline.

**Conclusion**

correctionClassification() provides a unified and reliable method to
standardize classification tables before further processing.
When used with local CSV sources, it ensures consistent formatting while
avoiding external SPARQL calls, making it suitable for vignettes,
tests, and offline workflows.